Bootstrap: docker
From: condaforge/miniforge3:25.3.1-0
Stage: spython-base

%files
. .
%post

apt-get update && apt-get install -y git-all wget bzip2 tini vim less && rm -rf /var/lib/apt/lists/*

PATH="/opt/conda/bin:$PATH"

conda config --add channels bioconda

mamba create -y -n bohra-csvtk csvtk=0.33

mamba create -y -n bohra-mash -c bioconda mash csvtk

mamba create -y -n bohra-spades spades=3.15.2 python=3.8.16 csvtk

mamba create -y -n bohra-skesa skesa csvtk

mamba create -y -n bohra-seqtk seqtk csvtk

mamba create -y -n bohra-iqtree iqtree=2.2.0 csvtk gotree=0.4.5 snp-sites=2.5.1

mamba create -y -n bohra-quicktree quicktree=2.5 gotree=0.4.5 csvtk

mamba create -y -n bohra-prokka prokka csvtk

mamba create -y -n bohra-snippy snpeff=5.0 snippy=4.4.5 snp-sites=2.5.1 csvtk

mamba create -y -n bohra-shovill shovill=1.1.0 spades=3.15.2 python=3.8.16 csvtk

mamba create -y -n bohra-mlst mlst=2.19.0 csvtk pandas numpy

mamba create -y -n bohra-kraken2 kraken2=2.1.2 csvtk

mamba create -y -n bohra-mob_suite mob_suite=3.1.9 csvtk

mamba create -y -n bohra-panaroo panaroo python=3.10 biopython=1.81 csvtk

mamba create -y -n bohra-abritamr abritamr=1.0.19 csvtk
mamba run -n bohra-abritamr pip3 install --force-reinstall 'git+https://github.com/MDU-PHL/abritamr@int_bug'

mamba create -y -n bohra-gubbins gubbins=2.4.1 snp-sites=2.5.1 csvtk

mamba create -y -n bohra-snpdists snp-dists=0.8.2 csvtk

mamba create -y -n bohra-ectyper ectyper csvtk

mamba create -y -n bohra-emmtyper emmtyper csvtk

mamba create -y -n bohra-kleborate kleborate=2.3.2  csvtk

mamba create -y -n bohra-kmc kmc csvtk

mamba create -y -n bohra-lissero lissero csvtk

mamba create -y -n bohra-meningotype meningotype csvtk

mamba create -y -n bohra-ngmaster ngmaster csvtk

mamba create -y -n bohra-stype sistr_cmd=1.1.1 csvtk

mamba run -n bohra-stype pip3 install 'git+https://github.com/MDU-PHL/salmonella_typing'

mamba create -y -n bohra-tbtamr python=3.10 tbtamr=1.0.3 csvtk
mamba run -n bohra-tbtamr pip3 install pysam joblib tqdm pydantic requests git+https://github.com/jodyphelan/pathogen-profiler@v4.3.0


mamba create -y -n bohra-veryfasttree veryfasttree csvtk gotree=0.4.5

mamba create -y -n bohra-shigapass blast=2.16.0 csvtk

mamba create -y -n bohra-sonneitype mykrobe pandas csvtk

mamba create -y -n bohra-ska2 ska2 csvtk pandas

mamba create -y -n bohra-core-snp-filter core-snp-filter csvtk

mamba create -y -n bohra-cluster numpy pandas scikit-learn csvtk

mamba create -y -n bohra-classify-pangenome r-data.table=1.17.6 r-ggplot2=3.5.2 r-optparse=1.7.5

mamba create -y -n bohra-fastp fastp csvtk

mamba create -y -n bohra-seqkit seqkit==2.1.0 csvtk

mamba create -y -n bohra-lissero lissero python=3.11 csvtk


mamba  create -y -n bohra-datasmryzr python=3.11 csvtk
mamba run -n bohra-datasmryzr pip3  install git+https://github.com/kristyhoran/datasmryzr

mamba env create -f environment.yml

mamba run -n bohra pip3 install .

apt-get update && apt-get install -y 

conda clean -a -y

mamba clean -a -y
which tini
TINI_SUBREAPER=true

mkdir -p /home/bohra/workdir && chmod 777 -R /home/bohra/workdir
ls -lathr /home/bohra/workdir
BOHRA_WD=/home/bohra/workdir

%environment
export PATH="/opt/conda/bin:$PATH"
export TINI_SUBREAPER=true
export BOHRA_WD=/home/bohra/workdir


%runscript
eval "$(conda shell.bash hook)"
conda init bash >/dev/null 2>&1
conda activate bohra
exec "$@"